<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"> 
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
</head>
<script>
var all_obj;
function loadXMLDoc(){
  var xmlhttp; 
  if (window.XMLHttpRequest){
  // code for IE7+, Firefox, Chrome, Opera, Safari
    xmlhttp=new XMLHttpRequest();
  }
  else{
  // code for IE6, IE5
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  xmlhttp.onreadystatechange=function(){
    if (xmlhttp.readyState==4 && xmlhttp.status==200){
      all_obj = JSON.parse(xmlhttp.responseText);
	  $("#status").text("載入成功").fadeOut("slow");
    }
  }
  xmlhttp.open("GET", "all.txt", true);
  xmlhttp.send();
}
function getObjects(obj, key, val) {
    var objects = [];
    for (var i in obj) {
        if (!obj.hasOwnProperty(i)) continue;
        if (typeof obj[i] == 'object') {
            objects = objects.concat(getObjects(obj[i], key, val));
        } else if (i == key && obj[key] == val) {
            objects.push(obj);
        }
    }
    return objects;
}
</script>
<style>
#status{ width:100%; height:100%; display:block; background:hsla(240, 0%, 50%, 1); position:absolute; margin:0; text-align:center; font-family:"Microsoft JhengHei"; font-size:50px; line-height:500px;}
#content{ font-family:"Microsoft JhengHei"; font-size:12px;}
#header{ width:100%;}
#left{ float:left;}
#center{ }
#right{ float:right;}
</style>
<body onload="loadXMLDoc()">
<div id="status"><p>載入數據中...(久沒回應請重新整理)</p></div>
<div id="content">
	<div id="header">頭</div>
	<div id="left">
		<select name="dept_no" id="dept_no">
			<option value='0'>請選擇單位</option>
			<option value='C1'>數學系</option>
		</select>
	</div>
	<div id="center">
		<table id="search"></table>
	</div>
	<div id="right">
	</div>
	<div id="bottom"></div>
</div>
</body>
<script>
$("#dept_no").on( "change", function(){
	if($("#dept_no").val()=='C1'){
		var str="<th>課程名稱</th><th>年級</th><th>學分</th><th>選必修</th><th>老師</th><th>系號</th><th>序號</th><th>時間</th><th>地點</th><tbody>";
		var obj = getObjects(all_obj, 'dept_no', 'C1');
		for (i = 0; i < obj.length; i++) { 
			str += "<tr><td>"+ obj[i].course_name +"</td><td>"+ obj[i].year + "</td><td>"+ obj[i].credit + "</td><td>"+ obj[i].rc +"</td><td>"+ obj[i].teacher +"</td><td>"+ obj[i].dept_no+"</td><td>"+ obj[i].course_id+"</td><td>"+ obj[i].time+"</td><td>"+ obj[i].location + "</td></tr>";
		}
		str += "</tbody>"
		$("#search").html(str);
	}
});
</script>
</html>
